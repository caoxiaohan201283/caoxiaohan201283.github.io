<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>桐乡高桥中学论坛</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#E63946',
            neutral: '#F5F7FA',
            dark: '#1D2129',
            'neutral-dark': '#4E5969'
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .transition-all-300 {
        transition: all 300ms ease-in-out;
      }
      .animate-pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      .animate-slide-up {
        animation: slideUp 0.3s ease-in-out;
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>

<body class="font-inter bg-neutral text-dark min-h-screen flex flex-col">
  <!-- 导航栏 -->
  <header id="navbar" class="bg-white shadow-md fixed w-full z-50 transition-all duration-300 py-3">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <img src="https://p26-doubao-search-sign.byteimg.com/labis/image/40eb5adf30c1225975290792b98394dd~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779890545&x-signature=5Wyhu1%2B7m%2Bj3IMPA29mpm3Clf6k%3D" alt="学校Logo" class="h-10 w-10 object-cover rounded-md">
        <h1 class="text-xl font-bold text-primary">高桥实验学校论坛</h1>
      </div>
      
      <nav class="hidden md:flex items-center space-x-8">
        <a href="#school-intro" class="nav-link font-medium hover:text-primary transition-colors">学校简介</a>
        <a href="#forum" class="nav-link font-medium hover:text-primary transition-colors">交流论坛</a>
        <a href="#chat" class="nav-link font-medium hover:text-primary transition-colors">实时聊天</a>
      </nav>
      
      <div class="flex items-center space-x-4">
        <button id="notification-btn" class="relative p-2 hover:text-primary transition-colors">
          <i class="fa fa-bell-o text-xl"></i>
          <span class="absolute top-0 right-0 h-4 w-4 bg-secondary text-white text-xs rounded-full flex items-center justify-center">3</span>
        </button>
        <div id="user-menu" class="relative">
          <button id="user-btn" class="flex items-center space-x-2 focus:outline-none">
            <img id="user-avatar" src="https://picsum.photos/id/237/200/200" alt="用户头像" class="h-8 w-8 rounded-full object-cover border-2 border-primary">
            <span id="user-nickname" class="hidden md:inline font-medium">游客</span>
            <i class="fa fa-angle-down text-neutral-dark"></i>
          </button>
          <div id="user-dropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-50 animate-slide-up">
            <a href="#" class="block px-4 py-2 text-sm hover:bg-neutral transition-colors" onclick="showMyProfile()">个人资料</a>
            <a href="#" class="block px-4 py-2 text-sm hover:bg-neutral transition-colors" onclick="showSettings()">设置</a>
            <div class="border-t border-gray-100 my-1"></div>
            <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-secondary hover:bg-neutral transition-colors">退出登录</a>
          </div>
        </div>
        <button id="mobile-menu-btn" class="md:hidden p-2 hover:text-primary transition-colors">
          <i class="fa fa-bars text-xl"></i>
        </button>
      </div>
    </div>
    
    <!-- 移动端菜单 -->
    <div id="mobile-menu" class="md:hidden hidden bg-white border-t animate-slide-up">
      <div class="container mx-auto px-4 py-3 flex flex-col space-y-3">
        <a href="#school-intro" class="py-2 font-medium hover:text-primary transition-colors">学校简介</a>
        <a href="#forum" class="py-2 font-medium hover:text-primary transition-colors">交流论坛</a>
        <a href="#chat" class="py-2 font-medium hover:text-primary transition-colors">实时聊天</a>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-grow pt-16">
    <!-- 英雄区 -->
    <section class="relative bg-primary text-white py-16 md:py-24 overflow-hidden">
      <div class="absolute inset-0 opacity-10">
        <img src="https://p26-doubao-search-sign.byteimg.com/labis/image/40eb5adf30c1225975290792b98394dd~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779890545&x-signature=5Wyhu1%2B7m%2Bj3IMPA29mpm3Clf6k%3D" alt="" class="w-full h-full object-cover">
      </div>
      <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-3xl mx-auto text-center">
          <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-4 text-shadow">桐乡高桥实验学校论坛</h1>
          <p class="text-[clamp(1rem,2vw,1.25rem)] mb-8 opacity-90">连接每一位高桥学子，分享校园生活，共创美好回忆</p>
          <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href="#forum" class="bg-white text-primary font-medium px-6 py-3 rounded-lg hover:shadow-lg transition-all transform hover:-translate-y-1">
              进入论坛
            </a>
            <a href="#school-intro" class="bg-transparent border-2 border-white text-white font-medium px-6 py-3 rounded-lg hover:bg-white/10 transition-all">
              了解学校
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- 学校简介板块 -->
    <section id="school-intro" class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-4">学校简介</h2>
          <div class="w-20 h-1 bg-primary mx-auto rounded-full"></div>
        </div>
        
        <div class="grid md:grid-cols-2 gap-10 items-center">
          <div>
            <img src="https://p26-doubao-search-sign.byteimg.com/labis/image/40eb5adf30c1225975290792b98394dd~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779890545&x-signature=5Wyhu1%2B7m%2Bj3IMPA29mpm3Clf6k%3D" alt="桐乡高桥实验学校" class="w-full h-auto rounded-lg shadow-lg object-cover">
          </div>
          
          <div class="space-y-6">
            <div>
              <h3 class="text-xl font-semibold mb-2 text-primary">桐乡高桥实验学校</h3>
              <p class="text-neutral-dark">浙江省桐乡市的一所公办实验学校</p>
            </div>
            
            <p class="text-neutral-dark leading-relaxed">
              桐乡高桥实验学校位于浙江省嘉兴市桐乡市，是一所融合优质教育资源的现代化实验学校。学校以"生长教育"为核心理念，构建了特色育人体系，配备先进的教学设施与优美的校园环境，致力于培养全面发展的新时代学子。
            </p>
            
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-neutral p-4 rounded-lg">
                <h4 class="font-semibold mb-1">办学理念</h4>
                <p class="text-neutral-dark">生长教育</p>
              </div>
              <div class="bg-neutral p-4 rounded-lg">
                <h4 class="font-semibold mb-1">学校性质</h4>
                <p class="text-neutral-dark">公办实验学校</p>
              </div>
              <div class="bg-neutral p-4 rounded-lg">
                <h4 class="font-semibold mb-1">地址</h4>
                <p class="text-neutral-dark">浙江省桐乡市</p>
              </div>
              <div class="bg-neutral p-4 rounded-lg">
                <h4 class="font-semibold mb-1">办学特色</h4>
                <p class="text-neutral-dark">素质教育+个性发展</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="mt-16 space-y-10">
          <div>
            <h3 class="text-2xl font-semibold mb-4 flex items-center">
              <i class="fa fa-star text-secondary mr-2"></i>
              办学特色
            </h3>
            <div class="bg-neutral p-6 rounded-lg">
              <p class="text-neutral-dark leading-relaxed">
                学校以"生长教育"为核心办学理念，注重学生的个性化发展与全面成长。校园环境融入人文与自然元素，打造了兼具美学与教育功能的空间（如图中"生长教育"主题墙面），同时构建了多元化的课程体系，涵盖学科拓展、艺术素养、实践创新等领域。
              </p>
            </div>
          </div>
          
          <div>
            <h3 class="text-2xl font-semibold mb-4 flex items-center">
              <i class="fa fa-image text-secondary mr-2"></i>
              校园环境
            </h3>
            <img src="https://p6-doubao-sign.byteimg.com/tos-cn-i-qvj2lq49k0/56104653285a4530893532878d73975a~tplv-qvj2lq49k0-resize-crop-v1:0:0:720:540:720:540.jpeg?rk3s=19ff00fe&x-expires=1779890545&x-signature=U%2B2sG8v0X6j1LqV63%2B%2B72d96Q8Q%3D" alt="生长教育主题墙面" class="w-full h-auto rounded-lg shadow-lg">
            <p class="text-neutral-dark mt-4 text-center">校园内的"生长教育"主题文化墙，体现了学校的核心理念</p>
          </div>
          
          <div>
            <h3 class="text-2xl font-semibold mb-4 flex items-center">
              <i class="fa fa-trophy text-secondary mr-2"></i>
              教学成果
            </h3>
            <div class="grid md:grid-cols-3 gap-6">
              <div class="bg-neutral p-6 rounded-lg hover:shadow-md transition-all">
                <h4 class="font-semibold mb-2">育人成果</h4>
                <p class="text-neutral-dark">学生综合素质评价优秀率持续高于区域平均水平</p>
              </div>
              <div class="bg-neutral p-6 rounded-lg hover:shadow-md transition-all">
                <h4 class="font-semibold mb-2">课程建设</h4>
                <p class="text-neutral-dark">多项特色课程入选市级精品课程名录</p>
              </div>
              <div class="bg-neutral p-6 rounded-lg hover:shadow-md transition-all">
                <h4 class="font-semibold mb-2">硬件建设</h4>
                <p class="text-neutral-dark">配备现代化教学设施，校园信息化覆盖率100%</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 自由交流论坛板块 -->
    <section id="forum" class="py-16 bg-neutral">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-4">交流论坛</h2>
          <p class="text-neutral-dark max-w-2xl mx-auto">在这里，你可以畅所欲言，分享校园生活，讨论学习问题，结交志同道合的朋友</p>
          <div class="w-20 h-1 bg-primary mx-auto rounded-full mt-4"></div>
        </div>
        
        <div class="mb-8 flex justify-between items-center">
          <div class="flex space-x-2 overflow-x-auto pb-2 scrollbar-hide">
            <button class="px-4 py-2 bg-primary text-white rounded-full text-sm whitespace-nowrap">全部帖子</button>
            <button class="px-4 py-2 bg-white text-neutral-dark rounded-full text-sm whitespace-nowrap hover:bg-primary/10 transition-colors">学习交流</button>
            <button class="px-4 py-2 bg-white text-neutral-dark rounded-full text-sm whitespace-nowrap hover:bg-primary/10 transition-colors">校园活动</button>
            <button class="px-4 py-2 bg-white text-neutral-dark rounded-full text-sm whitespace-nowrap hover:bg-primary/10 transition-colors">社团招新</button>
            <button class="px-4 py-2 bg-white text-neutral-dark rounded-full text-sm whitespace-nowrap hover:bg-primary/10 transition-colors">求助问答</button>
            <button class="px-4 py-2 bg-white text-neutral-dark rounded-full text-sm whitespace-nowrap hover:bg-primary/10 transition-colors">闲聊灌水</button>
          </div>
          
          <button id="create-post-btn" class="bg-secondary hover:bg-secondary/90 text-white px-5 py-2 rounded-lg flex items-center transition-colors">
            <i class="fa fa-pencil mr-2"></i> 发布帖子
          </button>
        </div>
        
        <!-- 帖子列表 -->
        <div class="space-y-6" id="posts-container">
          <!-- 帖子会通过JS动态加载 -->
        </div>
        
        <!-- 加载更多 -->
        <div class="text-center mt-10">
          <button id="load-more-btn" class="bg-white text-primary border border-primary px-6 py-3 rounded-lg hover:bg-primary/5 transition-colors">
            加载更多 <i class="fa fa-angle-down ml-1"></i>
          </button>
          <div id="loading-indicator" class="hidden">
            <div class="inline-block animate-pulse-slow">
              <i class="fa fa-spinner fa-spin text-primary text-xl"></i>
              <span class="ml-2">加载中...</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 实时聊天板块 -->
    <section id="chat" class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="text-center mb-12">
          <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-dark mb-4">实时聊天</h2>
          <p class="text-neutral-dark max-w-2xl mx-auto">与好友实时交流，分享校园趣事，解决学习难题</p>
          <div class="w-20 h-1 bg-primary mx-auto rounded-full mt-4"></div>
        </div>
        
        <div class="grid md:grid-cols-4 gap-6">
          <!-- 好友列表 -->
          <div class="md:col-span-1 bg-neutral rounded-xl overflow-hidden shadow-sm">
            <div class="p-4 border-b border-gray-200">
              <div class="relative">
                <input type="text" placeholder="搜索好友..." class="w-full bg-white border border-gray-200 rounded-lg py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-primary/50">
                <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-dark"></i>
              </div>
            </div>
            
            <div class="flex border-b border-gray-200">
              <button class="flex-1 py-3 text-center font-medium text-primary border-b-2 border-primary" id="friends-tab">好友 (2)</button>
              <button class="flex-1 py-3 text-center font-medium text-neutral-dark hover:text-primary transition-colors" id="groups-tab">群聊 (2)</button>
            </div>
            
            <div class="h-[calc(100vh-400px)] overflow-y-auto scrollbar-hide" id="friends-list">
              <!-- 好友申请提示 -->
              <div class="p-3 bg-secondary/10 text-secondary flex items-center justify-between cursor-pointer hover:bg-secondary/20 transition-colors" id="friend-requests">
                <div class="flex items-center space-x-3">
                  <i class="fa fa-user-plus text-xl"></i>
                  <div>
                    <p class="font-medium">新的好友申请</p>
                    <p class="text-xs">1个请求等待处理</p>
                  </div>
                </div>
                <span class="bg-secondary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">1</span>
              </div>
              
              <!-- 在线好友 -->
              <div class="px-4 py-2 text-xs text-neutral-dark uppercase font-medium">在线好友</div>
              
              <div class="p-3 hover:bg-gray-200 transition-colors cursor-pointer bg-primary/5 border-l-4 border-primary" data-friend="阳光少年">
                <div class="flex items-center space-x-3">
                  <div class="relative">
                    <img src="https://picsum.photos/id/1025/200/200" alt="好友头像" class="w-10 h-10 rounded-full object-cover">
                    <span class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full"></span>
                  </div>
                  <div class="flex-grow min-w-0">
                    <p class="font-medium truncate">阳光少年</p>
                    <p class="text-xs text-neutral-dark truncate" id="last-message-preview">刚发了新的运动会照片</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-neutral-dark">刚刚</p>
                    <span class="bg-secondary text-white text-xs rounded-full h-4 w-4 flex items-center justify-center mt-1" id="unread-count">2</span>
                  </div>
                </div>
              </div>
              
              <!-- 离线好友 -->
              <div class="px-4 py-2 text-xs text-neutral-dark uppercase font-medium">离线好友</div>
              
              <div class="p-3 hover:bg-gray-200 transition-colors cursor-pointer" data-friend="学霸君">
                <div class="flex items-center space-x-3">
                  <div class="relative">
                    <img src="https://picsum.photos/id/1074/200/200" alt="好友头像" class="w-10 h-10 rounded-full object-cover opacity-70">
                  </div>
                  <div class="flex-grow min-w-0">
                    <p class="font-medium truncate">学霸君</p>
                    <p class="text-xs text-neutral-dark truncate">数学复习资料已上传</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-neutral-dark">2小时前</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 群聊列表 -->
            <div class="h-[calc(100vh-400px)] overflow-y-auto scrollbar-hide hidden" id="groups-list">
              <div class="px-4 py-2 text-xs text-neutral-dark uppercase font-medium">我的群聊</div>
              
              <div class="p-3 hover:bg-gray-200 transition-colors cursor-pointer" data-group="初二(3)班班级群">
                <div class="flex items-center space-x-3">
                  <div class="relative">
                    <img src="https://picsum.photos/id/177/200/200" alt="群聊头像" class="w-10 h-10 rounded-full object-cover">
                    <span class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full"></span>
                  </div>
                  <div class="flex-grow min-w-0">
                    <p class="font-medium truncate">初二(3)班班级群</p>
                    <p class="text-xs text-neutral-dark truncate">班主任: 下周有家长会</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-neutral-dark">5分钟前</p>
                  </div>
                </div>
              </div>
              
              <div class="p-3 hover:bg-gray-200 transition-colors cursor-pointer" data-group="篮球社团">
                <div class="flex items-center space-x-3">
                  <div class="relative">
                    <img src="https://picsum.photos/id/178/200/200" alt="群聊头像" class="w-10 h-10 rounded-full object-cover">
                    <span class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full"></span>
                  </div>
                  <div class="flex-grow min-w-0">
                    <p class="font-medium truncate">篮球社团</p>
                    <p class="text-xs text-neutral-dark truncate">队长: 明天下午训练</p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs text-neutral-dark">1小时前</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 聊天窗口 -->
          <div class="md:col-span-3 bg-neutral rounded-xl overflow-hidden shadow-sm flex flex-col">
            <!-- 聊天头部 -->
            <div class="p-4 border-b border-gray-200 flex items-center justify-between bg-white">
              <div class="flex items-center space-x-3">
                <div class="relative">
                  <img src="https://picsum.photos/id/1025/200/200" alt="好友头像" class="w-10 h-10 rounded-full object-cover">
                  <span class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 border-2 border-white rounded-full animate-pulse"></span>
                </div>
                <div>
                  <p class="font-medium" id="chat-friend-name">阳光少年</p>
                  <p class="text-xs text-neutral-dark" id="chat-status">在线 - 正在输入...</p>
                </div>
              </div>
              
              <div class="flex space-x-4">
                <button class="p-2 text-neutral-dark hover:text-primary transition-colors" id="voice-call-btn">
                  <i class="fa fa-phone"></i>
                </button>
                <button class="p-2 text-neutral-dark hover:text-primary transition-colors" id="video-call-btn">
                  <i class="fa fa-video-camera"></i>
                </button>
                <button class="p-2 text-neutral-dark hover:text-primary transition-colors" id="friend-info-btn">
                  <i class="fa fa-info-circle"></i>
                </button>
              </div>
            </div>
            
            <!-- 聊天内容 -->
            <div class="flex-grow p-4 overflow-y-auto scrollbar-hide space-y-4" id="chat-messages">
              <!-- 聊天记录会通过JS动态加载 -->
            </div>
            
            <!-- 聊天输入框 -->
            <div class="p-4 border-t border-gray-200 bg-white">
              <div class="flex items-center space-x-3 mb-2">
                <button class="p-2 text-neutral-dark hover:text-primary transition-colors" id="emoji-btn">
                  <i class="fa fa-smile-o"></i>
                </button>
                <label for="chat-image-upload" class="p-2 text-neutral-dark hover:text-primary transition-colors cursor-pointer">
                  <i class="fa fa-picture-o"></i>
                </label>
                <input type="file" id="chat-image-upload" accept="image/*" class="hidden">
                <button class="p-2 text-neutral-dark hover:text-primary transition-colors" id="file-btn">
                  <i class="fa fa-file-o"></i>
                </button>
                <button class="p-2 text-neutral-dark hover:text-primary transition-colors" id="voice-btn">
                  <i class="fa fa-microphone"></i>
                </button>
              </div>
              
              <div class="flex items-center space-x-3">
                <input type="text" placeholder="输入消息..." id="message-input" class="flex-grow bg-neutral border border-gray-200 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-primary/50">
                <button id="send-message" class="bg-primary hover:bg-primary/90 text-white rounded-lg p-2 transition-colors">
                  <i class="fa fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 页脚 -->
  <footer class="bg-dark text-white py-10">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center space-x-2 mb-4">
            <img src="https://p26-doubao-search-sign.byteimg.com/labis/image/40eb5adf30c1225975290792b98394dd~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779890545&x-signature=5Wyhu1%2B7m%2Bj3IMPA29mpm3Clf6k%3D" alt="学校Logo" class="h-8 w-8 object-cover rounded-md">
            <h3 class="text-lg font-bold">高桥实验学校论坛</h3>
          </div>
          <p class="text-gray-400 text-sm">连接每一位高桥学子，分享校园生活，共创美好回忆</p>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold mb-4">快速链接</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="#school-intro" class="hover:text-white transition-colors">学校简介</a></li>
            <li><a href="#forum" class="hover:text-white transition-colors">交流论坛</a></li>
            <li><a href="#chat" class="hover:text-white transition-colors">实时聊天</a></li>
            <li><a href="#" class="hover:text-white transition-colors">校园公告</a></li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold mb-4">联系我们</h4>
          <ul class="space-y-2 text-gray-400">
            <li class="flex items-center"><i class="fa fa-map-marker mr-2"></i> 浙江省桐乡市</li>
            <li class="flex items-center"><i class="fa fa-phone mr-2"></i> 0573-88888888</li>
            <li class="flex items-center"><i class="fa fa-envelope-o mr-2"></i> 1253982165@qq.com</li>
          </ul>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold mb-4">关注我们</h4>
          <div class="flex space-x-4 mb-4">
            <a href="#" class="bg-gray-800 hover:bg-primary w-10 h-10 rounded-full flex items-center justify-center transition-colors">
              <i class="fa fa-weixin"></i>
            </a>
            <a href="#" class="bg-gray-800 hover:bg-primary w-10 h-10 rounded-full flex items-center justify-center transition-colors">
              <i class="fa fa-weibo"></i>
            </a>
            <a href="#" class="bg-gray-800 hover:bg-primary w-10 h-10 rounded-full flex items-center justify-center transition-colors">
              <i class="fa fa-qq"></i>
            </a>
          </div>
          <p class="text-gray-400 text-sm">扫描二维码关注学校公众号</p>
          <img src="https://picsum.photos/id/110/100/100" alt="公众号二维码" class="w-24 h-24 mt-2">
        </div>
      </div>
      
      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-500 text-sm">
        <p>© 2023 桐乡高桥实验学校论坛 版权所有 | 浙ICP备XXXXXXXX号</p>
      </div>
    </div>
  </footer>

  <!-- 登录/注册模态框 -->
  <div id="auth-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl transform transition-all animate-slide-up">
      <div class="text-center mb-6">
        <h3 class="text-2xl font-bold text-dark" id="auth-modal-title">登录</h3>
        <p class="text-neutral-dark mt-1">欢迎回到高桥实验学校论坛</p>
      </div>
      
      <form id="auth-form">
        <div class="mb-4">
          <label for="name" class="block text-sm font-medium text-dark mb-1">姓名</label>
          <input type="text" id="name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入你的姓名" required>
          <div class="hidden text-secondary text-xs mt-1" id="name-error">请输入姓名</div>
        </div>
        
        <div class="mb-6">
          <label for="password" class="block text-sm font-medium text-dark mb-1">密码</label>
          <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入密码" required minlength="6">
          <div class="hidden text-secondary text-xs mt-1" id="password-error">密码长度不能少于6位</div>
        </div>
        
        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 rounded-lg transition-colors mb-4">
          <span id="auth-btn-text">登录</span>
        </button>
        
        <div class="text-center">
          <p class="text-neutral-dark text-sm">
            <span id="auth-switch-text">还没有账号？</span>
            <button type="button" id="auth-switch-btn" class="text-primary font-medium ml-1">注册</button>
          </p>
        </div>
      </form>
    </div>
  </div>

  <!-- 发布帖子模态框 -->
  <div id="post-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-2xl p-6 shadow-2xl transform transition-all max-h-[90vh] overflow-y-auto animate-slide-up">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-dark">发布新帖子</h3>
        <button id="close-post-modal" class="text-neutral-dark hover:text-dark transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="post-form">
        <div class="mb-4">
          <label for="post-title" class="block text-sm font-medium text-dark mb-1">标题</label>
          <input type="text" id="post-title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入帖子标题" required maxlength="50">
          <div class="hidden text-secondary text-xs mt-1" id="title-error">标题不能为空且长度不超过50字</div>
        </div>
        
        <div class="mb-4">
          <label for="post-category" class="block text-sm font-medium text-dark mb-1">分类</label>
          <select id="post-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" required>
            <option value="">请选择分类</option>
            <option value="study">学习交流</option>
            <option value="activity">校园活动</option>
            <option value="club">社团招新</option>
            <option value="help">求助问答</option>
            <option value="chat">闲聊灌水</option>
          </select>
          <div class="hidden text-secondary text-xs mt-1" id="category-error">请选择分类</div>
        </div>
        
        <div class="mb-4">
          <label for="post-content" class="block text-sm font-medium text-dark mb-1">内容</label>
          <textarea id="post-content" rows="6" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="请输入帖子内容..." required minlength="10"></textarea>
          <div class="hidden text-secondary text-xs mt-1" id="content-error">内容不能为空且长度不低于10字</div>
        </div>
        
        <div class="mb-6">
          <label class="block text-sm font-medium text-dark mb-1">上传图片（可选）</label>
          <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors cursor-pointer" id="upload-area">
            <i class="fa fa-cloud-upload text-3xl text-neutral-dark mb-2"></i>
            <p class="text-neutral-dark mb-2">点击或拖拽图片到此处上传</p>
            <p class="text-xs text-neutral-dark">支持JPG、PNG格式，最多5张</p>
            <input type="file" multiple accept="image/*" class="hidden" id="post-images">
          </div>
          <div class="flex flex-wrap gap-2 mt-3" id="image-preview-container"></div>
        </div>
        
        <button type="submit" class="w-full bg-secondary hover:bg-secondary/90 text-white font-medium py-3 rounded-lg transition-colors">
          发布帖子
        </button>
      </form>
    </div>
  </div>

  <!-- 用户资料模态框 -->
  <div id="profile-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-2xl p-6 shadow-2xl transform transition-all animate-slide-up">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-dark" id="profile-modal-title">用户资料</h3>
        <button id="close-profile-modal" class="text-neutral-dark hover:text-dark transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="flex flex-col md:flex-row gap-6">
        <div class="md:w-1/3 flex flex-col items-center">
          <div class="relative mb-4">
            <img id="profile-avatar" src="https://picsum.photos/id/1025/200/200" alt="用户头像" class="w-32 h-32 rounded-full object-cover border-4 border-primary">
            <label for="avatar-upload" class="absolute bottom-0 right-0 bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center cursor-pointer">
              <i class="fa fa-pencil"></i>
            </label>
            <input type="file" id="avatar-upload" accept="image/*" class="hidden">
          </div>
          
          <h4 id="profile-name" class="text-xl font-bold mb-1">阳光少年</h4>
          <p id="profile-id" class="text-neutral-dark text-sm mb-4">学号: 20210315</p>
          
          <button id="edit-profile-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-colors w-full mb-2">
            <i class="fa fa-edit mr-2"></i> 编辑资料
          </button>
          
          <button id="add-friend-btn" class="bg-white border border-primary text-primary hover:bg-primary/5 font-medium px-6 py-2 rounded-lg transition-colors w-full hidden">
            <i class="fa fa-user-plus mr-2"></i> 加为好友
          </button>
        </div>
        
        <div class="md:w-2/3 space-y-4">
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <h5 class="text-sm font-medium text-neutral-dark mb-1">昵称</h5>
              <p id="profile-nickname" class="font-medium">阳光少年</p>
            </div>
            <div>
              <h5 class="text-sm font-medium text-neutral-dark mb-1">性别</h5>
              <p id="profile-gender" class="font-medium">男</p>
            </div>
          </div>
          
          <div>
            <h5 class="text-sm font-medium text-neutral-dark mb-1">个人简介</h5>
            <p id="profile-bio" class="font-medium">初二(3)班学生，喜欢运动和摄影，欢迎大家加我好友~</p>
          </div>
          
          <div>
            <h5 class="text-sm font-medium text-neutral-dark mb-1">发布的帖子</h5>
            <div class="bg-neutral rounded-lg p-3">
              <p class="text-neutral-dark">共发布了 <span id="post-count">12</span> 个帖子</p>
            </div>
          </div>
          
          <div>
            <h5 class="text-sm font-medium text-neutral-dark mb-1">最近动态</h5>
            <div class="bg-neutral rounded-lg p-3">
              <p class="text-neutral-dark" id="latest-activity">2小时前 发布了关于运动会的帖子</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 编辑资料表单（默认隐藏） -->
      <div id="edit-profile-form" class="mt-8 hidden">
        <h4 class="text-lg font-semibold mb-4">编辑个人资料</h4>
        <div class="grid md:grid-cols-2 gap-4 mb-4">
          <div>
            <label for="edit-nickname" class="block text-sm font-medium text-dark mb-1">昵称</label>
            <input type="text" id="edit-nickname" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
          </div>
          <div>
            <label for="edit-gender" class="block text-sm font-medium text-dark mb-1">性别</label>
            <select id="edit-gender" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
              <option value="男">男</option>
              <option value="女">女</option>
              <option value="保密">保密</option>
            </select>
          </div>
        </div>
        <div class="mb-4">
          <label for="edit-bio" class="block text-sm font-medium text-dark mb-1">个人简介</label>
          <textarea id="edit-bio" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50"></textarea>
        </div>
        <div class="flex justify-end gap-3">
          <button type="button" id="cancel-edit-btn" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
            取消
          </button>
          <button type="button" id="save-profile-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
            保存修改
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 设置模态框 -->
  <div id="settings-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-2xl p-6 shadow-2xl transform transition-all animate-slide-up">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-dark">设置</h3>
        <button id="close-settings-modal" class="text-neutral-dark hover:text-dark transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-6">
        <div>
          <h4 class="text-lg font-semibold mb-4">通知设置</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span>新消息通知</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <span>帖子回复通知</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <span>好友申请通知</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>
          </div>
        </div>
        
        <div>
          <h4 class="text-lg font-semibold mb-4">隐私设置</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span>允许陌生人查看我的资料</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <span>允许陌生人给我发消息</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
              </label>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end">
          <button id="save-settings-btn" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
            保存设置
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 好友申请模态框 -->
  <div id="friend-request-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl transform transition-all animate-slide-up">
      <div class="text-center mb-6">
        <h3 class="text-2xl font-bold text-dark">好友申请</h3>
        <p class="text-neutral-dark mt-1">1个好友申请等待处理</p>
      </div>
      
      <div class="space-y-4 mb-6">
        <div class="flex items-center justify-between p-3 bg-neutral rounded-lg">
          <div class="flex items-center space-x-3">
            <img src="https://picsum.photos/id/1074/200/200" alt="用户头像" class="w-10 h-10 rounded-full object-cover">
            <div>
              <p class="font-medium">学霸君</p>
              <p class="text-xs text-neutral-dark">初二(1)班</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button class="px-3 py-1 bg-primary text-white text-sm rounded-lg hover:bg-primary/90 transition-colors" onclick="acceptFriendRequest('学霸君')">同意</button>
            <button class="px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition-colors" onclick="rejectFriendRequest('学霸君')">拒绝</button>
          </div>
        </div>
      </div>
      
      <div class="flex justify-end">
        <button id="close-friend-request-modal" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          关闭
        </button>
      </div>
    </div>
  </div>

  <!-- 评论模态框 -->
  <div id="comment-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-xl w-full max-w-2xl p-6 shadow-2xl transform transition-all max-h-[90vh] overflow-y-auto animate-slide-up">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-dark">评论</h3>
        <button id="close-comment-modal" class="text-neutral-dark hover:text-dark transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div id="comment-content" class="mb-6">
        <!-- 评论内容会动态加载 -->
      </div>
      
      <div class="border-t border-gray-200 pt-4">
        <div class="flex items-center space-x-3 mb-4">
          <input type="text" placeholder="写下你的评论..." id="comment-input" class="flex-grow bg-neutral border border-gray-200 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 focus:ring-primary/50">
          <button id="submit-comment" class="bg-primary hover:bg-primary/90 text-white rounded-lg px-4 py-2 transition-colors">
            发表
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 消息通知提示 -->
  <div id="notification-toast" class="fixed bottom-4 right-4 bg-dark text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 hidden">
    <div class="flex items-center">
      <i class="fa fa-bell mr-2"></i>
      <span id="notification-message">新消息通知</span>
    </div>
  </div>

  <script>
    // 初始化数据
    let currentPage = 1;
    const postsPerPage = 3;
    let isLoading = false;
    let currentChatFriend = '阳光少年';
    let currentPostId = '';
    
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化本地存储数据
      initLocalStorageData();
      
      // 检查用户是否已登录
      const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
      
      // 如果未登录，显示登录模态框
      if (!isLoggedIn) {
        document.getElementById('auth-modal').classList.remove('hidden');
      } else {
        // 更新用户信息
        updateUserInfo();
      }
      
      // 加载聊天记录
      loadChatHistory();
      
      // 加载帖子列表
      loadPosts(currentPage);
      
      // 导航栏滚动效果
      window.addEventListener('scroll', function() {
        const navbar = document.getElementById('navbar');
        if (window.scrollY > 50) {
          navbar.classList.add('py-2');
          navbar.classList.remove('py-3');
        } else {
          navbar.classList.add('py-3');
          navbar.classList.remove('py-2');
        }
      });
      
      // 移动端菜单切换
      document.getElementById('mobile-menu-btn').addEventListener('click', function() {
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenu.classList.toggle('hidden');
      });
      
      // 用户菜单下拉
      document.getElementById('user-btn').addEventListener('click', function() {
        const dropdown = document.getElementById('user-dropdown');
        dropdown.classList.toggle('hidden');
      });
      
      // 点击其他地方关闭下拉菜单
      document.addEventListener('click', function(event) {
        const userBtn = document.getElementById('user-btn');
        const dropdown = document.getElementById('user-dropdown');
        
        if (!userBtn.contains(event.target) && !dropdown.contains(event.target)) {
          dropdown.classList.add('hidden');
        }
      });
      
      // 登录/注册切换
      const authSwitchBtn = document.getElementById('auth-switch-btn');
      const authModalTitle = document.getElementById('auth-modal-title');
      const authBtnText = document.getElementById('auth-btn-text');
      const authSwitchText = document.getElementById('auth-switch-text');
      let isLoginMode = true;
      
      authSwitchBtn.addEventListener('click', function() {
        isLoginMode = !isLoginMode;
        
        if (isLoginMode) {
          authModalTitle.textContent = '登录';
          authBtnText.textContent = '登录';
          authSwitchText.textContent = '还没有账号？';
          authSwitchBtn.textContent = '注册';
        } else {
          authModalTitle.textContent = '注册';
          authBtnText.textContent = '注册';
          authSwitchText.textContent = '已有账号？';
          authSwitchBtn.textContent = '登录';
        }
      });
      
      // 登录/注册表单提交验证
      document.getElementById('auth-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const name = document.getElementById('name').value.trim();
        const password = document.getElementById('password').value;
        
        let isValid = true;
        
        // 验证姓名
        if (!name) {
          document.getElementById('name-error').classList.remove('hidden');
          isValid = false;
        } else {
          document.getElementById('name-error').classList.add('hidden');
        }
        
        // 验证密码
        if (password.length < 6) {
          document.getElementById('password-error').classList.remove('hidden');
          isValid = false;
        } else {
          document.getElementById('password-error').classList.add('hidden');
        }
        
        if (!isValid) return;
        
        // 模拟登录/注册成功
        if (isLoginMode) {
          // 登录逻辑
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const user = users.find(u => u.name === name && u.password === password);
          
          if (user) {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // 更新用户信息
            updateUserInfo();
            
            // 关闭模态框
            document.getElementById('auth-modal').classList.add('hidden');
            
            showNotification('登录成功！欢迎回来~');
          } else {
            alert('用户名或密码错误');
          }
        } else {
          // 注册逻辑
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const userExists = users.some(u => u.name === name);
          
          if (userExists) {
            alert('用户名已存在，请更换用户名');
            return;
          }
          
          const newUser = {
            id: Date.now().toString(),
            name: name,
            password: password,
            nickname: name,
            avatar: `https://picsum.photos/id/${Math.floor(Math.random() * 100)}/200/200`,
            gender: '保密',
            bio: '这个人很懒，什么都没有留下~',
            studentId: `202${Math.floor(Math.random() * 10)}${Math.floor(Math.random() * 10)}${Math.floor(Math.random() * 10)}${Math.floor(Math.random() * 10)}`
          };
          
          users.push(newUser);
          localStorage.setItem('users', JSON.stringify(users));
          localStorage.setItem('isLoggedIn', 'true');
          localStorage.setItem('currentUser', JSON.stringify(newUser));
          
          // 更新用户信息
          updateUserInfo();
          
          // 关闭模态框
          document.getElementById('auth-modal').classList.add('hidden');
          
          showNotification('注册成功！欢迎加入论坛~');
        }
      });
      
      // 退出登录
      document.getElementById('logout-btn').addEventListener('click', function() {
        localStorage.setItem('isLoggedIn', 'false');
        localStorage.removeItem('currentUser');
        
        // 更新用户信息
        document.getElementById('user-nickname').textContent = '游客';
        document.getElementById('user-avatar').src = 'https://picsum.photos/id/237/200/200';
        
        // 显示登录模态框
        document.getElementById('auth-modal').classList.remove('hidden');
      });
      
      // 发布帖子模态框
      document.getElementById('create-post-btn').addEventListener('click', function() {
        // 检查登录状态
        if (localStorage.getItem('isLoggedIn') !== 'true') {
          document.getElementById('auth-modal').classList.remove('hidden');
          return;
        }
        
        document.getElementById('post-modal').classList.remove('hidden');
        document.getElementById('image-preview-container').innerHTML = '';
      });
      
      document.getElementById('close-post-modal').addEventListener('click', function() {
        document.getElementById('post-modal').classList.add('hidden');
        document.getElementById('post-form').reset();
        document.getElementById('image-preview-container').innerHTML = '';
      });
      
      // 图片上传区域点击事件
      const uploadArea = document.getElementById('upload-area');
      const postImagesInput = document.getElementById('post-images');
      
      uploadArea.addEventListener('click', function() {
        postImagesInput.click(); // 触发文件选择框
      });
      
      // 图片上传拖拽功能
      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('border-primary');
        uploadArea.classList.add('bg-primary/5');
      });
      
      uploadArea.addEventListener('dragleave', function() {
        uploadArea.classList.remove('border-primary');
        uploadArea.classList.remove('bg-primary/5');
      });
      
      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('border-primary');
        uploadArea.classList.remove('bg-primary/5');
        
        if (e.dataTransfer.files.length > 0) {
          handlePostImagesUpload({ target: { files: e.dataTransfer.files } });
        }
      });
      
      // 图片上传处理
      postImagesInput.addEventListener('change', handlePostImagesUpload);
      
      // 发布帖子表单提交
      document.getElementById('post-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const title = document.getElementById('post-title').value.trim();
        const category = document.getElementById('post-category').value;
        const content = document.getElementById('post-content').value.trim();
        
        let isValid = true;
        
        // 验证标题
        if (!title || title.length > 50) {
          document.getElementById('title-error').classList.remove('hidden');
          isValid = false;
        } else {
          document.getElementById('title-error').classList.add('hidden');
        }
        
        // 验证分类
        if (!category) {
          document.getElementById('category-error').classList.remove('hidden');
          isValid = false;
        } else {
          document.getElementById('category-error').classList.add('hidden');
        }
        
        // 验证内容
        if (!content || content.length < 10) {
          document.getElementById('content-error').classList.remove('hidden');
          isValid = false;
        } else {
          document.getElementById('content-error').classList.add('hidden');
        }
        
        if (!isValid) return;
        
        // 获取当前用户
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        
        // 创建新帖子
        const newPost = {
          id: Date.now().toString(),
          title: title,
          content: content,
          category: category,
          categoryName: getCategoryName(category),
          author: {
            id: currentUser.id,
            name: currentUser.nickname || currentUser.name,
            avatar: currentUser.avatar || 'https://picsum.photos/id/237/200/200'
          },
          images: Array.from(document.querySelectorAll('#image-preview-container img')).map(img => img.src),
          createdAt: new Date().toISOString(),
          likes: 0,
          comments: 0,
          shares: 0,
          likedBy: [],
          commentsList: []
        };
        
        // 保存到本地存储
        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
        posts.unshift(newPost); // 添加到开头
        localStorage.setItem('posts', JSON.stringify(posts));
        
        // 更新用户发布帖子数
        updateUserPostCount();
        
        // 关闭模态框并重置表单
        document.getElementById('post-modal').classList.add('hidden');
        this.reset();
        document.getElementById('image-preview-container').innerHTML = '';
        
        // 重新加载帖子列表
        currentPage = 1;
        loadPosts(currentPage);
        
        showNotification('帖子发布成功！');
      });
      
      // 加载更多帖子
      document.getElementById('load-more-btn').addEventListener('click', function() {
        if (isLoading) return;
        
        currentPage++;
        loadPosts(currentPage);
      });
      
      // 关闭用户资料模态框
      document.getElementById('close-profile-modal').addEventListener('click', function() {
        document.getElementById('profile-modal').classList.add('hidden');
        document.getElementById('edit-profile-form').classList.add('hidden');
        document.getElementById('edit-profile-btn').classList.remove('hidden');
      });
      
      // 编辑资料按钮
      document.getElementById('edit-profile-btn').addEventListener('click', function() {
        document.getElementById('edit-profile-form').classList.remove('hidden');
        this.classList.add('hidden');
        
        // 填充表单数据
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        document.getElementById('edit-nickname').value = currentUser.nickname || currentUser.name;
        document.getElementById('edit-gender').value = currentUser.gender || '保密';
        document.getElementById('edit-bio').value = currentUser.bio || '这个人很懒，什么都没有留下~';
      });
      
      // 取消编辑
      document.getElementById('cancel-edit-btn').addEventListener('click', function() {
        document.getElementById('edit-profile-form').classList.add('hidden');
        document.getElementById('edit-profile-btn').classList.remove('hidden');
      });
      
      // 保存资料修改
      document.getElementById('save-profile-btn').addEventListener('click', function() {
        const nickname = document.getElementById('edit-nickname').value.trim();
        const gender = document.getElementById('edit-gender').value;
        const bio = document.getElementById('edit-bio').value.trim();
        
        if (!nickname) {
          alert('昵称不能为空');
          return;
        }
        
        // 更新当前用户信息
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        currentUser.nickname = nickname;
        currentUser.gender = gender;
        currentUser.bio = bio;
        
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // 更新用户列表中的信息
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const userIndex = users.findIndex(u => u.id === currentUser.id);
        if (userIndex !== -1) {
          users[userIndex] = currentUser;
          localStorage.setItem('users', JSON.stringify(users));
        }
        
        // 更新显示
        updateUserInfo();
        document.getElementById('profile-nickname').textContent = nickname;
        document.getElementById('profile-gender').textContent = gender;
        document.getElementById('profile-bio').textContent = bio;
        
        // 隐藏编辑表单
        document.getElementById('edit-profile-form').classList.add('hidden');
        document.getElementById('edit-profile-btn').classList.remove('hidden');
        
        showNotification('资料修改成功！');
      });
      
      // 添加好友
      document.getElementById('add-friend-btn').addEventListener('click', function() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const profileName = document.getElementById('profile-name').textContent;
        
        if (currentUser.nickname === profileName) {
          alert('不能添加自己为好友！');
          return;
        }
        
        // 发送好友申请
        const friendRequests = JSON.parse(localStorage.getItem('friendRequests') || '[]');
        friendRequests.push({
          from: currentUser.nickname || currentUser.name,
          to: profileName,
          status: 'pending',
          timestamp: new Date().toISOString()
        });
        localStorage.setItem('friendRequests', JSON.stringify(friendRequests));
        
        showNotification('好友申请已发送！');
        document.getElementById('profile-modal').classList.add('hidden');
      });
      
      // 发送消息
      document.getElementById('send-message').addEventListener('click', sendMessage);
      document.getElementById('message-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });
      
      // 好友列表点击事件
      document.querySelectorAll('#friends-list [data-friend]').forEach(friend => {
        friend.addEventListener('click', function() {
          const friendName = this.getAttribute('data-friend');
          switchChatFriend(friendName);
        });
      });
      
      // 群聊列表点击事件
      document.querySelectorAll('#groups-list [data-group]').forEach(group => {
        group.addEventListener('click', function() {
          const groupName = this.getAttribute('data-group');
          switchChatGroup(groupName);
        });
      });
      
      // 好友申请点击事件
      document.getElementById('friend-requests').addEventListener('click', function() {
        document.getElementById('friend-request-modal').classList.remove('hidden');
      });
      
      // 群聊和好友标签切换
      document.getElementById('friends-tab').addEventListener('click', function() {
        document.getElementById('friends-list').classList.remove('hidden');
        document.getElementById('groups-list').classList.add('hidden');
        this.classList.add('text-primary', 'border-b-2', 'border-primary');
        document.getElementById('groups-tab').classList.remove('text-primary', 'border-b-2', 'border-primary');
      });
      
      document.getElementById('groups-tab').addEventListener('click', function() {
        document.getElementById('friends-list').classList.add('hidden');
        document.getElementById('groups-list').classList.remove('hidden');
        this.classList.add('text-primary', 'border-b-2', 'border-primary');
        document.getElementById('friends-tab').classList.remove('text-primary', 'border-b-2', 'border-primary');
      });
      
      // 聊天功能按钮
      document.getElementById('voice-call-btn').addEventListener('click', function() {
        alert('语音通话功能正在开发中...');
      });
      
      document.getElementById('video-call-btn').addEventListener('click', function() {
        alert('视频通话功能正在开发中...');
      });
      
      document.getElementById('friend-info-btn').addEventListener('click', function() {
        showFriendProfile(currentChatFriend);
      });
      
      document.getElementById('emoji-btn').addEventListener('click', function() {
        alert('表情功能正在开发中...');
      });
      
      document.getElementById('file-btn').addEventListener('click', function() {
        alert('文件发送功能正在开发中...');
      });
      
      document.getElementById('voice-btn').addEventListener('click', function() {
        alert('语音消息功能正在开发中...');
      });
      
      // 聊天图片上传
      document.getElementById('chat-image-upload').addEventListener('change', handleChatImageUpload);
      
      // 头像上传
      document.getElementById('avatar-upload').addEventListener('change', handleAvatarUpload);
      
      // 设置模态框
      document.getElementById('close-settings-modal').addEventListener('click', function() {
        document.getElementById('settings-modal').classList.add('hidden');
      });
      
      document.getElementById('save-settings-btn').addEventListener('click', function() {
        showNotification('设置已保存！');
        document.getElementById('settings-modal').classList.add('hidden');
      });
      
      // 好友申请模态框
      document.getElementById('close-friend-request-modal').addEventListener('click', function() {
        document.getElementById('friend-request-modal').classList.add('hidden');
      });
      
      // 评论模态框
      document.getElementById('close-comment-modal').addEventListener('click', function() {
        document.getElementById('comment-modal').classList.add('hidden');
      });
      
      document.getElementById('submit-comment').addEventListener('click', function() {
        const commentInput = document.getElementById('comment-input');
        const comment = commentInput.value.trim();
        
        if (!comment) {
          alert('请输入评论内容');
          return;
        }
        
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        
        if (!currentUser.id) {
          document.getElementById('auth-modal').classList.remove('hidden');
          document.getElementById('comment-modal').classList.add('hidden');
          return;
        }
        
        // 添加评论
        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
        const postIndex = posts.findIndex(p => p.id === currentPostId);
        
        if (postIndex !== -1) {
          const post = posts[postIndex];
          
          if (!post.commentsList) {
            post.commentsList = [];
          }
          
          post.commentsList.push({
            id: Date.now().toString(),
            author: {
              id: currentUser.id,
              name: currentUser.nickname || currentUser.name,
              avatar: currentUser.avatar || 'https://picsum.photos/id/237/200/200'
            },
            content: comment,
            createdAt: new Date().toISOString()
          });
          
          post.comments = post.commentsList.length;
          
          localStorage.setItem('posts', JSON.stringify(posts));
          
          // 重新加载帖子
          currentPage = 1;
          loadPosts(currentPage);
          
          // 关闭评论模态框
          document.getElementById('comment-modal').classList.add('hidden');
          commentInput.value = '';
          
          showNotification('评论发表成功！');
        }
      });
      
      // 平滑滚动
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          
          const targetId = this.getAttribute('href');
          if (targetId === '#') return;
          
          const targetElement = document.querySelector(targetId);
          if (targetElement) {
            window.scrollTo({
              top: targetElement.offsetTop - 80,
              behavior: 'smooth'
            });
            
            // 关闭移动端菜单
            document.getElementById('mobile-menu').classList.add('hidden');
          }
        });
      });
      
      // 点击模态框外部关闭模态框
      function closeModalOnOutsideClick(modalId) {
        const modal = document.getElementById(modalId);
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            modal.classList.add('hidden');
            if (modalId === 'profile-modal') {
              document.getElementById('edit-profile-form').classList.add('hidden');
              document.getElementById('edit-profile-btn').classList.remove('hidden');
            }
            if (modalId === 'post-modal') {
              document.getElementById('post-form').reset();
              document.getElementById('image-preview-container').innerHTML = '';
            }
            if (modalId === 'comment-modal') {
              document.getElementById('comment-input').value = '';
            }
          }
        });
      }
      
      // 给所有模态框添加外部点击关闭功能
      closeModalOnOutsideClick('auth-modal');
      closeModalOnOutsideClick('post-modal');
      closeModalOnOutsideClick('profile-modal');
      closeModalOnOutsideClick('settings-modal');
      closeModalOnOutsideClick('friend-request-modal');
      closeModalOnOutsideClick('comment-modal');
    });
    
    // 初始化本地存储数据
    function initLocalStorageData() {
      // 初始化用户数据
      if (!localStorage.getItem('users')) {
        const defaultUsers = [
          {
            id: '1',
            name: '阳光少年',
            password: '123456',
            nickname: '阳光少年',
            avatar: 'https://picsum.photos/id/1025/200/200',
            gender: '男',
            bio: '初二(3)班学生，喜欢运动和摄影，欢迎大家加我好友~',
            studentId: '20210315'
          },
          {
            id: '2',
            name: '学霸君',
            password: '123456',
            nickname: '学霸君',
            avatar: 'https://picsum.photos/id/1074/200/200',
            gender: '男',
            bio: '初二(1)班学习委员，数学爱好者，乐于分享学习经验~',
            studentId: '20210108'
          }
        ];
        localStorage.setItem('users', JSON.stringify(defaultUsers));
      }
      
      // 初始化帖子数据
      if (!localStorage.getItem('posts')) {
        const defaultPosts = [
          {
            id: '1',
            title: '学校秋季运动会将于下周五举行，大家准备好了吗？',
            content: '听说今年运动会增加了不少新项目，还有团体接力赛，有没有同学想一起组队的？我们班还缺几个人...',
            category: 'activity',
            categoryName: '校园活动',
            author: {
              id: '1',
              name: '阳光少年',
              avatar: 'https://picsum.photos/id/1025/200/200'
            },
            images: ['https://picsum.photos/id/1060/300/200', 'https://picsum.photos/id/1062/300/200'],
            createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
            likes: 32,
            comments: 2,
            shares: 5,
            likedBy: ['2'],
            commentsList: [
              {
                id: '1',
                author: {
                  id: '2',
                  name: '学霸君',
                  avatar: 'https://picsum.photos/id/1074/200/200'
                },
                content: '我要报名接力赛！',
                createdAt: new Date(Date.now() - 60 * 60 * 1000).toISOString()
              },
              {
                id: '2',
                author: {
                  id: '1',
                  name: '阳光少年',
                  avatar: 'https://picsum.photos/id/1025/200/200'
                },
                content: '太好了！我们班现在有5个人报名了',
                createdAt: new Date(Date.now() - 30 * 60 * 1000).toISOString()
              }
            ]
          },
          {
            id: '2',
            title: '分享一些数学期中考试的复习技巧，希望对大家有帮助',
            content: '1. 重点复习函数和几何部分，这两部分占分比较大\n2. 多做模拟题，尤其是往年的真题\n3. 整理错题本，考前再看一遍...\n\n需要详细复习资料的可以留言，我可以分享给大家~',
            category: 'study',
            categoryName: '学习交流',
            author: {
              id: '2',
              name: '学霸君',
              avatar: 'https://picsum.photos/id/1074/200/200'
            },
            images: [],
            createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
            likes: 78,
            comments: 1,
            shares: 23,
            likedBy: ['1'],
            commentsList: [
              {
                id: '1',
                author: {
                  id: '1',
                  name: '阳光少年',
                  avatar: 'https://picsum.photos/id/1025/200/200'
                },
                content: '太感谢了！数学一直是我的弱项',
                createdAt: new Date(Date.now() - 20 * 60 * 60 * 1000).toISOString()
              }
            ]
          }
        ];
        localStorage.setItem('posts', JSON.stringify(defaultPosts));
      }
      
      // 初始化聊天记录
      if (!localStorage.getItem('chatHistory')) {
        const defaultChat = [
          {
            sender: 'friend',
            message: '嗨，你看到学校运动会的通知了吗？',
            timestamp: new Date(Date.now() - 10 * 60 * 1000).toISOString()
          },
          {
            sender: 'me',
            message: '看到了，下周五对吧？打算报什么项目？',
            timestamp: new Date(Date.now() - 8 * 60 * 1000).toISOString()
          },
          {
            sender: 'friend',
            message: '我想报100米和跳远，你呢？',
            timestamp: new Date(Date.now() - 6 * 60 * 1000).toISOString()
          },
          {
            sender: 'me',
            message: '我可能报个接力赛吧，单项不太擅长',
            timestamp: new Date(Date.now() - 5 * 60 * 1000).toISOString()
          }
        ];
        localStorage.setItem('chatHistory', JSON.stringify(defaultChat));
      }
      
      // 初始化好友申请
      if (!localStorage.getItem('friendRequests')) {
        const defaultRequests = [
          {
            from: '学霸君',
            to: '阳光少年',
            status: 'pending',
            timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
          }
        ];
        localStorage.setItem('friendRequests', JSON.stringify(defaultRequests));
      }
    }
    
    // 更新用户信息
    function updateUserInfo() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      
      if (currentUser && currentUser.nickname) {
        document.getElementById('user-nickname').textContent = currentUser.nickname;
        document.getElementById('user-avatar').src = currentUser.avatar || 'https://picsum.photos/id/237/200/200';
      }
    }
    
    // 加载帖子列表
    function loadPosts(page) {
      const postsContainer = document.getElementById('posts-container');
      const loadMoreBtn = document.getElementById('load-more-btn');
      const loadingIndicator = document.getElementById('loading-indicator');
      
      if (page === 1) {
        postsContainer.innerHTML = '';
      }
      
      isLoading = true;
      loadingIndicator.classList.remove('hidden');
      loadMoreBtn.classList.add('hidden');
      
      // 模拟加载延迟
      setTimeout(() => {
        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
        const startIndex = (page - 1) * postsPerPage;
        const endIndex = startIndex + postsPerPage;
        const postsToShow = posts.slice(startIndex, endIndex);
        
        if (postsToShow.length === 0) {
          loadMoreBtn.classList.add('hidden');
          loadingIndicator.classList.add('hidden');
          isLoading = false;
          return;
        }
        
        postsToShow.forEach(post => {
          const postElement = createPostElement(post);
          postsContainer.appendChild(postElement);
        });
        
        loadingIndicator.classList.add('hidden');
        loadMoreBtn.classList.remove('hidden');
        isLoading = false;
        
        // 如果没有更多帖子了，隐藏加载更多按钮
        if (endIndex >= posts.length) {
          loadMoreBtn.classList.add('hidden');
        }
      }, 500);
    }
    
    // 创建帖子元素
    function createPostElement(post) {
      const postElement = document.createElement('div');
      postElement.className = 'bg-white rounded-xl shadow-sm p-6 transition-all hover:shadow-md';
      
      const timeAgo = getTimeAgo(post.createdAt);
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      const isLiked = post.likedBy && post.likedBy.includes(currentUser.id);
      
      postElement.innerHTML = `
        <div class="flex items-start justify-between mb-4">
          <div class="flex items-center space-x-3">
            <img src="${post.author.avatar}" alt="${post.author.name}" class="w-10 h-10 rounded-full object-cover cursor-pointer" onclick="showUserProfile('${post.author.id}')">
            <div>
              <p class="font-medium cursor-pointer" onclick="showUserProfile('${post.author.id}')">${post.author.name}</p>
              <p class="text-xs text-neutral-dark">${timeAgo}</p>
            </div>
          </div>
          <span class="px-3 py-1 bg-primary/10 text-primary text-xs rounded-full">${post.categoryName}</span>
        </div>
        
        <h3 class="text-lg font-semibold mb-2">${post.title}</h3>
        <p class="text-neutral-dark mb-4 whitespace-pre-line">${post.content}</p>
        
        ${post.images && post.images.length > 0 ? `
          <div class="grid grid-cols-${Math.min(post.images.length, 3)} gap-2 mb-4">
            ${post.images.map(img => `<img src="${img}" alt="帖子图片" class="w-full h-32 object-cover rounded-lg">`).join('')}
          </div>
        ` : ''}
        
        <div class="flex items-center justify-between pt-4 border-t border-gray-100">
          <div class="flex space-x-4">
            <button class="flex items-center space-x-1 ${isLiked ? 'text-primary' : 'text-neutral-dark'} hover:text-primary transition-colors" data-post-id="${post.id}" onclick="toggleLike('${post.id}')">
              <i class="fa ${isLiked ? 'fa-thumbs-up' : 'fa-thumbs-o-up'}"></i>
              <span>${post.likes}</span>
            </button>
            <button class="flex items-center space-x-1 text-neutral-dark hover:text-primary transition-colors" data-post-id="${post.id}" onclick="showCommentModal('${post.id}')">
              <i class="fa fa-comment-o"></i>
              <span>${post.comments}</span>
            </button>
            <button class="flex items-center space-x-1 text-neutral-dark hover:text-primary transition-colors" data-post-id="${post.id}" onclick="sharePost('${post.id}')">
              <i class="fa fa-share-alt"></i>
              <span>${post.shares}</span>
            </button>
          </div>
          <button class="text-neutral-dark hover:text-primary transition-colors">
            <i class="fa fa-bookmark-o"></i>
          </button>
        </div>
        
        ${post.commentsList && post.commentsList.length > 0 ? `
          <div class="mt-4 pt-4 border-t border-gray-100">
            <h4 class="text-sm font-medium mb-2">评论</h4>
            ${post.commentsList.slice(0, 2).map(comment => `
              <div class="flex items-start space-x-2 mb-2">
                <img src="${comment.author.avatar}" alt="${comment.author.name}" class="w-6 h-6 rounded-full object-cover mt-1 cursor-pointer" onclick="showUserProfile('${comment.author.id}')">
                <div>
                  <p class="text-sm font-medium cursor-pointer" onclick="showUserProfile('${comment.author.id}')">${comment.author.name}</p>
                  <p class="text-sm text-neutral-dark">${comment.content}</p>
                  <p class="text-xs text-neutral-dark">${getTimeAgo(comment.createdAt)}</p>
                </div>
              </div>
            `).join('')}
            ${post.commentsList.length > 2 ? `<p class="text-xs text-primary cursor-pointer" onclick="showAllComments('${post.id}')">查看全部${post.commentsList.length}条评论</p>` : ''}
          </div>
        ` : ''}
      `;
      
      return postElement;
    }
    
    // 获取时间差
    function getTimeAgo(timestamp) {
      const now = new Date();
      const postDate = new Date(timestamp);
      const diffMs = now - postDate;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return '刚刚';
      if (diffMins < 60) return `${diffMins}分钟前`;
      if (diffHours < 24) return `${diffHours}小时前`;
      if (diffDays < 7) return `${diffDays}天前`;
      
      return postDate.toLocaleDateString('zh-CN');
    }
    
    // 获取分类名称
    function getCategoryName(category) {
      const categoryMap = {
        'study': '学习交流',
        'activity': '校园活动',
        'club': '社团招新',
        'help': '求助问答',
        'chat': '闲聊灌水'
      };
      
      return categoryMap[category] || '其他';
    }
    
    // 加载聊天记录
    function loadChatHistory() {
      const chatMessages = document.getElementById('chat-messages');
      const chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
      
      chatMessages.innerHTML = '';
      
      chatHistory.forEach(msg => {
        const messageElement = document.createElement('div');
        messageElement.className = `flex ${msg.sender === 'me' ? 'justify-end' : 'justify-start'}`;
        
        messageElement.innerHTML = `
          <div class="max-w-xs md:max-w-md ${msg.sender === 'me' ? 'bg-primary text-white' : 'bg-white'} rounded-lg p-3 shadow-sm">
            <p>${msg.message}</p>
            <p class="text-xs opacity-70 mt-1">${new Date(msg.timestamp).toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'})}</p>
          </div>
        `;
        
        chatMessages.appendChild(messageElement);
      });
      
      // 滚动到底部
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // 发送消息
    function sendMessage() {
      const messageInput = document.getElementById('message-input');
      const message = messageInput.value.trim();
      
      if (!message) return;
      
      // 获取聊天记录
      const chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
      
      // 添加新消息
      chatHistory.push({
        sender: 'me',
        message: message,
        timestamp: new Date().toISOString()
      });
      
      // 保存到本地存储
      localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
      
      // 清空输入框
      messageInput.value = '';
      
      // 重新加载聊天记录
      loadChatHistory();
      
      // 模拟好友回复
      setTimeout(() => {
        const replies = [
          '听起来不错！',
          '我也这么觉得',
          '那我们到时候见',
          '好的，没问题',
          '谢谢你的建议'
        ];
        
        const randomReply = replies[Math.floor(Math.random() * replies.length)];
        
        const updatedChatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
        updatedChatHistory.push({
          sender: 'friend',
          message: randomReply,
          timestamp: new Date().toISOString()
        });
        
        localStorage.setItem('chatHistory', JSON.stringify(updatedChatHistory));
        loadChatHistory();
      }, 1000 + Math.random() * 2000);
    }
    
    // 切换聊天好友
    function switchChatFriend(friendName) {
      currentChatFriend = friendName;
      document.getElementById('chat-friend-name').textContent = friendName;
      document.getElementById('chat-status').textContent = '在线';
      
      // 重置聊天记录
      const defaultChat = [
        {
          sender: 'friend',
          message: `嗨，我是${friendName}，很高兴和你聊天！`,
          timestamp: new Date().toISOString()
        }
      ];
      localStorage.setItem('chatHistory', JSON.stringify(defaultChat));
      loadChatHistory();
      
      // 更新好友列表中的选中状态
      document.querySelectorAll('#friends-list [data-friend]').forEach(friend => {
        if (friend.getAttribute('data-friend') === friendName) {
          friend.classList.add('bg-primary/5', 'border-l-4', 'border-primary');
        } else {
          friend.classList.remove('bg-primary/5', 'border-l-4', 'border-primary');
        }
      });
    }
    
    // 切换群聊
    function switchChatGroup(groupName) {
      document.getElementById('chat-friend-name').textContent = groupName;
      document.getElementById('chat-status').textContent = '群聊 - 5人在线';
      
      // 重置聊天记录
      const defaultChat = [
        {
          sender: 'friend',
          message: `欢迎来到${groupName}！`,
          timestamp: new Date().toISOString()
        }
      ];
      localStorage.setItem('chatHistory', JSON.stringify(defaultChat));
      loadChatHistory();
      
      // 更新群聊列表中的选中状态
      document.querySelectorAll('#groups-list [data-group]').forEach(group => {
        if (group.getAttribute('data-group') === groupName) {
          group.classList.add('bg-primary/5', 'border-l-4', 'border-primary');
        } else {
          group.classList.remove('bg-primary/5', 'border-l-4', 'border-primary');
        }
      });
    }
    
    // 显示我的个人资料
    function showMyProfile() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      
      if (!currentUser.id) {
        document.getElementById('auth-modal').classList.remove('hidden');
        return;
      }
      
      // 填充个人资料
      document.getElementById('profile-avatar').src = currentUser.avatar || 'https://picsum.photos/id/237/200/200';
      document.getElementById('profile-name').textContent = currentUser.nickname || currentUser.name;
      document.getElementById('profile-id').textContent = `学号: ${currentUser.studentId || '未设置'}`;
      document.getElementById('profile-nickname').textContent = currentUser.nickname || currentUser.name;
      document.getElementById('profile-gender').textContent = currentUser.gender || '保密';
      document.getElementById('profile-bio').textContent = currentUser.bio || '这个人很懒，什么都没有留下~';
      
      // 计算帖子数量
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const userPosts = posts.filter(post => post.author.id === currentUser.id);
      document.getElementById('post-count').textContent = userPosts.length;
      
      // 设置最近动态
      if (userPosts.length > 0) {
        const latestPost = userPosts[0];
        document.getElementById('latest-activity').textContent = `${getTimeAgo(latestPost.createdAt)} 发布了"${latestPost.title}"`;
      } else {
        document.getElementById('latest-activity').textContent = '暂无动态';
      }
      
      // 隐藏加好友按钮
      document.getElementById('add-friend-btn').classList.add('hidden');
      
      // 显示模态框
      document.getElementById('profile-modal').classList.remove('hidden');
    }
    
    // 显示用户资料
    function showUserProfile(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === userId);
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      
      if (!user) {
        alert('用户不存在');
        return;
      }
      
      // 填充个人资料
      document.getElementById('profile-avatar').src = user.avatar || 'https://picsum.photos/id/237/200/200';
      document.getElementById('profile-name').textContent = user.nickname || user.name;
      document.getElementById('profile-id').textContent = `学号: ${user.studentId || '未设置'}`;
      document.getElementById('profile-nickname').textContent = user.nickname || user.name;
      document.getElementById('profile-gender').textContent = user.gender || '保密';
      document.getElementById('profile-bio').textContent = user.bio || '这个人很懒，什么都没有留下~';
      
      // 计算帖子数量
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const userPosts = posts.filter(post => post.author.id === userId);
      document.getElementById('post-count').textContent = userPosts.length;
      
      // 设置最近动态
      if (userPosts.length > 0) {
        const latestPost = userPosts[0];
        document.getElementById('latest-activity').textContent = `${getTimeAgo(latestPost.createdAt)} 发布了"${latestPost.title}"`;
      } else {
        document.getElementById('latest-activity').textContent = '暂无动态';
      }
      
      // 如果是查看自己的资料，隐藏加好友按钮
      if (currentUser.id === userId) {
        document.getElementById('add-friend-btn').classList.add('hidden');
        document.getElementById('edit-profile-btn').classList.remove('hidden');
      } else {
        document.getElementById('add-friend-btn').classList.remove('hidden');
        document.getElementById('edit-profile-btn').classList.add('hidden');
      }
      
      // 显示模态框
      document.getElementById('profile-modal').classList.remove('hidden');
    }
    
    // 显示好友资料
    function showFriendProfile(friendName) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.nickname === friendName);
      
      if (user) {
        showUserProfile(user.id);
      } else {
        alert('好友信息不存在');
      }
    }
    
    // 显示设置
    function showSettings() {
      document.getElementById('settings-modal').classList.remove('hidden');
    }
    
    // 处理帖子图片上传
    function handlePostImagesUpload(event) {
      const files = event.target.files;
      const previewContainer = document.getElementById('image-preview-container');
      
      // 限制最多5张图片
      const currentImages = previewContainer.querySelectorAll('img').length;
      const remainingSlots = 5 - currentImages;
      
      if (files.length > remainingSlots) {
        alert(`最多只能上传5张图片，您还可以上传${remainingSlots}张`);
        return;
      }
      
      for (let i = 0; i < Math.min(files.length, remainingSlots); i++) {
        const file = files[i];
        
        if (!file.type.match('image.*')) {
          alert('请上传图片文件');
          continue;
        }
        
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const imgElement = document.createElement('div');
          imgElement.className = 'relative';
          imgElement.innerHTML = `
            <img src="${e.target.result}" alt="预览图片" class="w-24 h-24 object-cover rounded-lg">
            <button type="button" class="absolute -top-2 -right-2 bg-secondary text-white rounded-full w-5 h-5 flex items-center justify-center text-xs" onclick="this.parentElement.remove()">
              <i class="fa fa-times"></i>
            </button>
          `;
          
          previewContainer.appendChild(imgElement);
        };
        
        reader.readAsDataURL(file);
      }
    }
    
    // 处理头像上传
    function handleAvatarUpload(event) {
      const file = event.target.files[0];
      
      if (!file || !file.type.match('image.*')) {
        alert('请上传图片文件');
        return;
      }
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        // 更新头像
        document.getElementById('profile-avatar').src = e.target.result;
        document.getElementById('user-avatar').src = e.target.result;
        
        // 更新本地存储
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        currentUser.avatar = e.target.result;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // 更新用户列表中的头像
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const userIndex = users.findIndex(u => u.id === currentUser.id);
        if (userIndex !== -1) {
          users[userIndex].avatar = e.target.result;
          localStorage.setItem('users', JSON.stringify(users));
        }
        
        showNotification('头像更新成功！');
      };
      
      reader.readAsDataURL(file);
    }
    
    // 处理聊天图片上传
    function handleChatImageUpload(event) {
      const file = event.target.files[0];
      
      if (!file || !file.type.match('image.*')) {
        alert('请上传图片文件');
        return;
      }
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        // 获取聊天记录
        const chatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
        
        // 添加图片消息
        chatHistory.push({
          sender: 'me',
          message: `<img src="${e.target.result}" alt="聊天图片" class="max-w-xs rounded-lg">`,
          timestamp: new Date().toISOString()
        });
        
        // 保存到本地存储
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        
        // 重新加载聊天记录
        loadChatHistory();
        
        // 模拟好友回复
        setTimeout(() => {
          const updatedChatHistory = JSON.parse(localStorage.getItem('chatHistory') || '[]');
          updatedChatHistory.push({
            sender: 'friend',
            message: '图片拍得不错！',
            timestamp: new Date().toISOString()
          });
          
          localStorage.setItem('chatHistory', JSON.stringify(updatedChatHistory));
          loadChatHistory();
        }, 1000 + Math.random() * 2000);
      };
      
      reader.readAsDataURL(file);
    }
    
    // 更新用户帖子数量
    function updateUserPostCount() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const userPosts = posts.filter(post => post.author.id === currentUser.id);
      
      document.getElementById('post-count').textContent = userPosts.length;
    }
    
    // 显示通知
    function showNotification(message) {
      const toast = document.getElementById('notification-toast');
      const messageElement = document.getElementById('notification-message');
      
      messageElement.textContent = message;
      toast.classList.remove('hidden');
      toast.classList.remove('translate-y-20', 'opacity-0');
      toast.classList.add('translate-y-0', 'opacity-100');
      
      setTimeout(() => {
        toast.classList.remove('translate-y-0', 'opacity-100');
        toast.classList.add('translate-y-20', 'opacity-0');
        
        setTimeout(() => {
          toast.classList.add('hidden');
        }, 300);
      }, 3000);
    }
    
    // 点赞功能
    function toggleLike(postId) {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      
      if (!currentUser.id) {
        document.getElementById('auth-modal').classList.remove('hidden');
        return;
      }
      
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const postIndex = posts.findIndex(p => p.id === postId);
      
      if (postIndex !== -1) {
        const post = posts[postIndex];
        
        if (!post.likedBy) {
          post.likedBy = [];
        }
        
        const userIndex = post.likedBy.indexOf(currentUser.id);
        
        if (userIndex === -1) {
          // 点赞
          post.likedBy.push(currentUser.id);
          post.likes++;
        } else {
          // 取消点赞
          post.likedBy.splice(userIndex, 1);
          post.likes--;
        }
        
        localStorage.setItem('posts', JSON.stringify(posts));
        
        // 重新加载帖子
        currentPage = 1;
        loadPosts(currentPage);
        
        showNotification(userIndex === -1 ? '点赞成功！' : '已取消点赞');
      }
    }
    
    // 显示评论模态框
    function showCommentModal(postId) {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      
      if (!currentUser.id) {
        document.getElementById('auth-modal').classList.remove('hidden');
        return;
      }
      
      currentPostId = postId;
      
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const post = posts.find(p => p.id === postId);
      
      if (post) {
        let commentsHtml = '';
        
        if (post.commentsList && post.commentsList.length > 0) {
          post.commentsList.forEach(comment => {
            commentsHtml += `
              <div class="flex items-start space-x-3 mb-4 pb-4 border-b border-gray-100">
                <img src="${comment.author.avatar}" alt="${comment.author.name}" class="w-8 h-8 rounded-full object-cover cursor-pointer" onclick="showUserProfile('${comment.author.id}')">
                <div class="flex-grow">
                  <p class="font-medium text-sm cursor-pointer" onclick="showUserProfile('${comment.author.id}')">${comment.author.name}</p>
                  <p class="text-neutral-dark text-sm mt-1">${comment.content}</p>
                  <p class="text-xs text-neutral-dark mt-1">${getTimeAgo(comment.createdAt)}</p>
                </div>
              </div>
            `;
          });
        } else {
          commentsHtml = '<p class="text-center text-neutral-dark py-4">暂无评论</p>';
        }
        
        document.getElementById('comment-content').innerHTML = commentsHtml;
        document.getElementById('comment-modal').classList.remove('hidden');
      }
    }
    
    // 分享帖子
    function sharePost(postId) {
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      const post = posts.find(p => p.id === postId);
      
      if (post) {
        post.shares++;
        localStorage.setItem('posts', JSON.stringify(posts));
        
        // 重新加载帖子
        currentPage = 1;
        loadPosts(currentPage);
        
        showNotification('分享成功！');
      }
    }
    
    // 显示所有评论
    function showAllComments(postId) {
      showCommentModal(postId);
    }
    
    // 接受好友申请
    function acceptFriendRequest(friendName) {
      const friendRequests = JSON.parse(localStorage.getItem('friendRequests') || '[]');
      const requestIndex = friendRequests.findIndex(r => r.from === friendName && r.status === 'pending');
      
      if (requestIndex !== -1) {
        friendRequests[requestIndex].status = 'accepted';
        localStorage.setItem('friendRequests', JSON.stringify(friendRequests));
        
        document.getElementById('friend-request-modal').classList.add('hidden');
        showNotification(`已接受 ${friendName} 的好友申请`);
        
        // 更新好友申请数量
        document.getElementById('friend-requests').querySelector('span').textContent = '0';
      }
    }
    
    // 拒绝好友申请
    function rejectFriendRequest(friendName) {
      const friendRequests = JSON.parse(localStorage.getItem('friendRequests') || '[]');
      const requestIndex = friendRequests.findIndex(r => r.from === friendName && r.status === 'pending');
      
      if (requestIndex !== -1) {
        friendRequests[requestIndex].status = 'rejected';
        localStorage.setItem('friendRequests', JSON.stringify(friendRequests));
        
        document.getElementById('friend-request-modal').classList.add('hidden');
        showNotification(`已拒绝 ${friendName} 的好友申请`);
        
        // 更新好友申请数量
        document.getElementById('friend-requests').querySelector('span').textContent = '0';
      }
    }
  </script>
</body>
</html>